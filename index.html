<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Suburb Tracker</title>
    <style>
        /* --- STYLING (CSS) --- */
        body {
            background-color: #000000; /* Pure black for high contrast */
            color: #ffffff;
            font-family: 'Courier New', monospace; /* Retro digital look */
            text-align: center;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden; /* Prevents scrolling */
        }

        #speed-box {
            font-size: 2.5rem;
            color: #00ff00; /* Bright Green for speed */
            margin-bottom: 20px;
        }

        #suburb-display {
            font-size: 4rem;
            font-weight: bold;
            color: #ffffff;
            text-transform: uppercase;
            line-height: 1.2;
            margin-bottom: 30px;
        }

        #history-box {
            font-size: 1.2rem;
            color: #888888;
            border-top: 1px solid #333;
            padding-top: 20px;
            width: 80%;
        }

        .history-item {
            margin: 5px 0;
        }

        /* A distinct color for the icon to make it pop */
        .icon {
            font-style: normal;
        }
    </style>
</head>
<body>

    <div id="speed-box">0 km/h</div>
    <div id="suburb-display">LOCATING...</div>
    <div id="history-box">
        </div>

    <script>
        // --- CONFIGURATION: EDIT YOUR ICONS HERE ---
        const suburbIcons = {
            "Chelsea": "üèñÔ∏è",        // Beach
            "Aspendale": "üèä",      // Swimming/Beach
            "Edithvale": "ü¶Ü",      // Wetlands
            "Bonbeach": "üèÑ",       // Surfing
            "Carrum": "üåâ",         // The Bridge
            "Seaford": "üå≤",        // Trees/Foreshore
            "Frankston": "üèôÔ∏è",      // City skyline
            "Mordialloc": "‚õµ",     // Boats/Creek
            "Mentone": "üè´",        // Schools/Historic
            "Parkdale": "‚òï",       // Cafes
            "Default": "üìç"         // Fallback if unknown
        };

        // --- VARIABLES ---
        let lastSuburb = "";
        let suburbHistory = [];
        const synth = window.speechSynthesis;

        // --- GPS TRACKING ---
        if ("geolocation" in navigator) {
            navigator.geolocation.watchPosition(updateLocation, console.error, {
                enableHighAccuracy: true,
                maximumAge: 1000
            });
        } else {
            document.getElementById('suburb-display').innerText = "NO GPS";
        }

        // --- MAIN FUNCTION ---
        async function updateLocation(position) {
            // 1. Update Speed
            const speedKmh = position.coords.speed ? Math.round(position.coords.speed * 3.6) : 0;
            document.getElementById('speed-box').innerText = speedKmh + " km/h";

            // 2. Get Suburb Name (Reverse Geocoding)
            // We throttle this to run only every few seconds to be nice to the API
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            
            // Using OpenStreetMap (Nominatim) - Free and easy
            const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=14`;

            try {
                const response = await fetch(url, { headers: { 'User-Agent': 'GrandpaPeteSuburbTracker/1.0' } });
                const data = await response.json();
                
                // Extract suburb name safely
                let currentSuburb = data.address.suburb || data.address.town || data.address.city_district || "Unknown";

                // Only update if the suburb has CHANGED
                if (currentSuburb !== lastSuburb && currentSuburb !== "Unknown") {
                    updateDisplay(currentSuburb);
                    lastSuburb = currentSuburb;
                }

            } catch (error) {
                console.log("GPS fetch error: " + error);
            }
        }

        // --- DISPLAY & LOGIC ---
        function updateDisplay(suburbName) {
            // 1. Find the Icon
            const icon = suburbIcons[suburbName] || suburbIcons["Default"];

            // 2. Update Screen
            const displayElement = document.getElementById('suburb-display');
            displayElement.innerHTML = `<span class="icon">${icon}</span><br>${suburbName}`;
            
            // Random High-Contrast Color for excitement
            const colors = ["#FFD700", "#00FFFF", "#FF69B4", "#ADFF2F", "#FFFFFF"];
            displayElement.style.color = colors[Math.floor(Math.random() * colors.length)];

            // 3. Speak the Name
            const utterance = new SpeechSynthesisUtterance(suburbName);
            synth.speak(utterance);

            // 4. Update History
            updateHistory(suburbName);
        }

        function updateHistory(suburb) {
            suburbHistory.unshift(suburb); // Add to top of list
            if (suburbHistory.length > 3) suburbHistory.pop(); // Keep only last 3
            
            const historyHTML = suburbHistory.map(s => 
                `<div class="history-item">${s}</div>`
            ).join('');
            
            document.getElementById('history-box').innerHTML = historyHTML;
        }
    </script>
</body>
</html>
